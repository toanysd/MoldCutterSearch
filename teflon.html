<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>テフロン加工管理 - Teflon Coating Management V4.31</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="teflon-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Header -->
<header class="header">
    <div class="header-content">
        <button class="back-btn" onclick="window.location.href='index.html'" title="戻る">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12 16L6 10L12 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <div class="header-title">
            <h1>🛡️ テフロン加工管理<br><small>Teflon Coating Management</small></h1>
        </div>
        <div class="header-actions">
            <button class="btn-header-icon" onclick="refreshTeflonData()" title="更新 / Refresh">
                <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                    <path d="M17 10C17 13.866 13.866 17 10 17C6.134 17 3 13.866 3 10C3 6.134 6.134 3 10 3C12.1 3 13.94 3.87 15.24 5.24M15 3V7H11" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
            <button class="btn-header-icon" onclick="exportTeflonCSV()" title="エクスポート / Export">
                <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                    <path d="M3 15v2a2 2 0 002 2h10a2 2 0 002-2v-2M10 3v12m0 0l-4-4m4 4l4-4" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
        </div>
    </div>
</header>

<!-- Status Filter Tabs -->
<section class="status-filter-section">
    <div class="container">
        <div class="status-tabs">
            <button class="status-tab active" data-status="all" onclick="filterByTeflonStatus('all')">
                <span class="tab-icon">📋</span>
                <div class="tab-content">
                    <span class="tab-label">すべて<br>Tất cả</span>
                    <span class="tab-count" id="countAll">0</span>
                </div>
            </button>
            
            <button class="status-tab" data-status="テフロン加工承認待ち" onclick="filterByTeflonStatus('テフロン加工承認待ち')">
                <span class="tab-icon">⏳</span>
                <div class="tab-content">
                    <span class="tab-label">承認待ち<br>Chờ xác nhận</span>
                    <span class="tab-count" id="countPending">0</span>
                </div>
            </button>
            
            <button class="status-tab" data-status="テフロン加工中" onclick="filterByTeflonStatus('テフロン加工中')">
                <span class="tab-icon">⚙️</span>
                <div class="tab-content">
                    <span class="tab-label">加工中<br>Đang mạ</span>
                    <span class="tab-count" id="countProcessing">0</span>
                </div>
            </button>
            
            <button class="status-tab" data-status="テフロン加工済" onclick="filterByTeflonStatus('テフロン加工済')">
                <span class="tab-icon">✅</span>
                <div class="tab-content">
                    <span class="tab-label">加工済<br>Đã mạ</span>
                    <span class="tab-count" id="countCompleted">0</span>
                </div>
            </button>
        </div>
    </div>
</section>

<!-- Search and Controls -->
<section class="controls-section">
    <div class="container">
        <div class="controls-wrapper">
            <!-- Search Box -->
            <div class="search-box">
                <svg class="search-icon" width="18" height="18" viewBox="0 0 20 20" fill="none">
                    <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                    <path d="M14 14l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <input type="text" id="teflonSearchInput" class="search-input" 
                       placeholder="金型ID、名称、図面番号で検索... / Tìm kiếm theo ID, tên, số bản vẽ..." 
                       oninput="handleTeflonSearch()">
            </div>
            
            <!-- Sort Control -->
            <div class="sort-control">
                <select id="teflonSortSelect" class="sort-select" onchange="handleTeflonSort()">
                    <option value="recent">最新順 / Mới nhất</option>
                    <option value="oldest">古い順 / Cũ nhất</option>
                    <option value="moldid">金型ID順 / Theo ID</option>
                    <option value="status">状態順 / Theo trạng thái</option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- Data Table Section -->
<section class="table-section">
    <div class="container">
        <!-- Table Header -->
        <div class="table-header">
            <h2 class="section-title">
                金型リスト<br>
                <small>Danh sách khuôn mạ Teflon</small>
            </h2>
            <div class="result-info">
                <span>表示 / Hiển thị: <strong id="displayCount">0</strong> / <strong id="totalCount">0</strong> 件</span>
            </div>
        </div>

        <!-- Table Wrapper -->
        <div class="table-container">
            <table class="data-table" id="teflonTable">
                <thead>
                    <tr>
                        <th class="sortable" onclick="sortTeflonTable('MoldID')">
                            金型ID<br><small>Mold ID</small>
                            <span class="sort-indicator" id="sortIconMoldID"></span>
                        </th>
                        <th class="sortable" onclick="sortTeflonTable('MoldName')">
                            名称<br><small>Tên khuôn</small>
                            <span class="sort-indicator" id="sortIconMoldName"></span>
                        </th>
                        <th class="sortable" onclick="sortTeflonTable('DrawingNumber')">
                            図面番号<br><small>Số bản vẽ</small>
                            <span class="sort-indicator" id="sortIconDrawingNumber"></span>
                        </th>
                        <th class="sortable" onclick="sortTeflonTable('TeflonStatus')">
                            状態<br><small>Trạng thái</small>
                            <span class="sort-indicator" id="sortIconTeflonStatus"></span>
                        </th>
                        <th class="sortable" onclick="sortTeflonTable('SentDate')">
                            送付日<br><small>Ngày gửi</small>
                            <span class="sort-indicator" id="sortIconSentDate"></span>
                        </th>
                        <th class="sortable" onclick="sortTeflonTable('ExpectedDate')">
                            返却予定<br><small>Dự kiến nhận</small>
                            <span class="sort-indicator" id="sortIconExpectedDate"></span>
                        </th>
                        <th class="sortable" onclick="sortTeflonTable('ReceivedDate')">
                            返却日<br><small>Đã nhận</small>
                            <span class="sort-indicator" id="sortIconReceivedDate"></span>
                        </th>
                        <th>操作<br><small>Thao tác</small></th>
                    </tr>
                </thead>
                <tbody id="teflonTableBody">
                    <!-- Dynamic content -->
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div id="teflonEmptyState" class="empty-state" style="display: none;">
            <div class="empty-icon">📭</div>
            <h3>データがありません<br>Không có dữ liệu</h3>
            <p>フィルタを変更してください<br>Vui lòng thay đổi bộ lọc</p>
        </div>

        <!-- Pagination -->
        <div class="pagination-bar">
            <div class="pagination-info">
                <span>ページ <strong id="teflonCurrentPage">1</strong> / <strong id="teflonTotalPages">1</strong></span>
            </div>
            <div class="pagination-controls">
                <button class="btn-page" id="teflonPrevBtn" onclick="teflonPrevPage()" disabled>
                    <svg width="14" height="14" viewBox="0 0 16 16">
                        <path d="M10 12L6 8l4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    前へ
                </button>
                <button class="btn-page" id="teflonNextBtn" onclick="teflonNextPage()" disabled>
                    次へ
                    <svg width="14" height="14" viewBox="0 0 16 16">
                        <path d="M6 12l4-4-4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                </button>
            </div>
            <select class="page-size-select" id="teflonPageSize" onchange="changeTeflonPageSize()">
                <option value="20">20件/ページ</option>
                <option value="50" selected>50件/ページ</option>
                <option value="100">100件/ページ</option>
            </select>
        </div>
    </div>
</section>

<!-- Update Teflon Modal -->
<div id="updateTeflonModal" class="modal-overlay">
    <div class="modal-dialog">
        <div class="modal-header">
            <h3>テフロン加工情報更新<br><small>Cập nhật thông tin mạ Teflon</small></h3>
            <button class="modal-close" onclick="closeUpdateTeflonModal()">×</button>
        </div>
        
        <form id="updateTeflonForm" class="modal-body" onsubmit="submitTeflonUpdate(event)">
            <!-- Mold Info Display -->
            <div class="info-display-card">
                <div class="info-row">
                    <span class="info-label">金型ID / Mold ID:</span>
                    <span class="info-value" id="updateMoldId">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">名称 / Name:</span>
                    <span class="info-value" id="updateMoldName">-</span>
                </div>
            </div>

            <!-- Form Fields -->
            <div class="form-grid">
                <div class="form-group full-width">
                    <label class="form-label">状態 / Trạng thái <span class="required">*</span></label>
                    <select id="teflonStatus" class="form-control" required onchange="handleTeflonStatusChange()">
                        <option value="">選択してください / Chọn</option>
                        <option value="テフロン加工承認待ち">⏳ 承認待ち / Chờ xác nhận</option>
                        <option value="テフロン加工中">⚙️ 加工中 / Đang mạ</option>
                        <option value="テフロン加工済">✅ 加工済 / Đã mạ xong</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">送付日 / Ngày gửi</label>
                    <input type="date" id="sentDate" class="form-control">
                </div>

                <div class="form-group">
                    <label class="form-label">返却予定日 / Ngày dự kiến</label>
                    <input type="date" id="expectedDate" class="form-control">
                </div>

                <div class="form-group">
                    <label class="form-label">返却日 / Ngày nhận</label>
                    <input type="date" id="receivedDate" class="form-control">
                </div>

                <div class="form-group">
                    <label class="form-label">業者 / Nhà cung cấp</label>
                    <select id="supplierId" class="form-control">
                        <option value="">選択してください / Chọn</option>
                        <!-- Populated from companies data -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">理由 / Lý do</label>
                    <select id="reason" class="form-control">
                        <option value="">選択してください / Chọn</option>
                        <option value="新規製造">新規製造 / Mới sản xuất</option>
                        <option value="定期メンテナンス">定期メンテナンス / Bảo trì</option>
                        <option value="劣化対応">劣化対応 / Xuống cấp</option>
                        <option value="製品品質改善">製品品質改善 / Cải thiện</option>
                        <option value="顧客要求">顧客要求 / Yêu cầu KH</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">費用 / Chi phí (¥)</label>
                    <input type="number" id="teflonCost" class="form-control" min="0" step="0.01">
                </div>

                <div class="form-group">
                    <label class="form-label">品質 / Chất lượng</label>
                    <select id="quality" class="form-control">
                        <option value="">選択してください / Chọn</option>
                        <option value="良好">✅ 良好 / Tốt</option>
                        <option value="可">⚠️ 可 / Chấp nhận</option>
                        <option value="不良">❌ 不良 / Không đạt</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">備考 / Ghi chú</label>
                    <textarea id="teflonNotes" class="form-control" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">担当者 / Người thực hiện</label>
                    <select id="createdBy" class="form-control">
                        <option value="">選択してください / Chọn</option>
                        <!-- Populated from employees data -->
                    </select>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeUpdateTeflonModal()">
                    キャンセル / Hủy
                </button>
                <button type="submit" class="btn btn-primary">
                    保存 / Lưu
                </button>
            </div>
        </form>
    </div>
</div>

<!-- History Modal -->
<div id="teflonLogModal" class="modal-overlay">
    <div class="modal-dialog modal-wide">
        <div class="modal-header">
            <h3>テフロン加工履歴<br><small>Lịch sử mạ Teflon</small></h3>
            <button class="modal-close" onclick="closeTeflonLogModal()">×</button>
        </div>
        
        <div class="modal-body">
            <!-- Mold Info -->
            <div class="info-display-card">
                <div class="info-row">
                    <span class="info-label">金型ID:</span>
                    <span class="info-value" id="historyMoldId">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">名称:</span>
                    <span class="info-value" id="historyMoldName">-</span>
                </div>
            </div>

            <!-- Timeline -->
            <div class="history-timeline" id="teflonLogTimeline">
                <!-- Dynamic timeline items -->
            </div>

            <!-- Empty State -->
            <div id="historyEmptyState" class="empty-state-small" style="display: none;">
                <p>履歴がありません<br>Chưa có lịch sử</p>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="teflonLoadingOverlay" class="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <p>処理中...<br>Đang xử lý...</p>
</div>

<!-- Toast Notification -->
<div id="teflonToast" class="toast"></div>

<!-- Scripts -->
<script src="teflon.js"></script>
</body>
</html>
