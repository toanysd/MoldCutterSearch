<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chi tiáº¿t khuÃ´n - MoldCutterSearch V6.3</title>
    <!-- V6.3 - Simplified header like V5.9/V6.0 + Comprehensive print layout + Fixed mold dimensions -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="detail-mold-styles.css">
</head>
<body class="mold-detail-page">
    
    <!-- ===== SIMPLIFIED HEADER V6.3 LIKE V5.9 ===== -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="javascript:goBack()" class="back-btn">â† æˆ»ã‚‹</a>
                <div class="mold-header-info">
                    <div class="mold-title-row">
                        <h1 class="mold-title" id="moldTitle">Loading...</h1>
                        <div class="mold-location" id="moldLocation">
                            ğŸ“ ä½ç½®æƒ…å ±èª­ã¿è¾¼ã¿ä¸­...
                        </div>
                    </div>
                    <p class="mold-subtitle">é‡‘å‹è©³ç´°æƒ…å ± / ThÃ´ng tin chi tiáº¿t khuÃ´n</p>
                </div>
            </div>
            
            <div class="header-actions">
                <button id="showLocationBtn" class="action-btn">ğŸ“ä½ç½®</button>
                <button id="showShipmentBtn" class="action-btn">ğŸššå‡ºè·</button>
                <button id="showCommentBtn" class="action-btn">ğŸ’¬ã‚³ãƒ¡ãƒ³ãƒˆ</button>
                <button onclick="generateComprehensivePrint()" class="action-btn">ğŸ–¨ï¸å°åˆ·</button>
                <button onclick="generatePDF()" class="action-btn">ğŸ“„PDF</button>
                <button onclick="reloadMoldDataFromGitHub()" class="action-btn">ğŸ”„æ›´æ–°</button>
            </div>
        </div>
    </header>

    <!-- ===== V6.3: COMPREHENSIVE PRINT LAYOUT - HIDDEN ON SCREEN ===== -->
    <div id="comprehensivePrintContent" class="print-only">
        <!-- This content is populated by JavaScript and only visible when printing -->
    </div>

    <!-- ===== TAB NAVIGATION V6.3 ===== -->
    <nav class="tab-navigation">
        <ul class="tab-nav">
            <li><a href="#summary" class="tab-link active" data-tab="summary">ğŸ“‹ç·åˆ</a></li>
            <li><a href="#product" class="tab-link" data-tab="product">ğŸ“¦è£½å“</a></li>
            <li><a href="#technical" class="tab-link" data-tab="technical">âš™ï¸æŠ€è¡“</a></li>
            <li><a href="#processing" class="tab-link" data-tab="processing">ğŸ”„å‡¦ç†</a></li>
        </ul>
    </nav>

    <!-- ===== TAB CONTENT V6.3 - SCREEN DISPLAY ===== -->
    <div class="tab-content-wrapper">
        
        <!-- Tab 1: ç·åˆ (Summary) -->
        <div id="summary" class="tab-pane active">
            <div class="content-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ“‹</div>
                    <h2 class="section-title">åŸºæœ¬æƒ…å ± / ThÃ´ng tin cÆ¡ báº£n</h2>
                </div>
                <div id="summaryBasicInfo">
                    <!-- Populated by JavaScript displaySummaryBasicInfo() -->
                </div>
            </div>

            <div class="content-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ“¦</div>
                    <h2 class="section-title">ãƒˆãƒ¬ã‚¤æƒ…å ± / ThÃ´ng tin khay</h2>
                </div>
                <div id="summaryTrayInfo">
                    <!-- Populated by JavaScript displaySummaryTrayInfo() -->
                </div>
            </div>

            <div class="content-section cutters-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ”§</div>
                    <h2 class="section-title">é–¢é€£ã‚«ãƒƒã‚¿ãƒ¼ / Dao cáº¯t liÃªn quan</h2>
                </div>
                <div id="summaryRelatedCutters">
                    <!-- Populated by JavaScript displaySummaryRelatedCutters() -->
                </div>
            </div>
        </div>

        <!-- Tab 2: è£½å“ (Product) -->
        <div id="product" class="tab-pane">
            <div class="content-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ“¦</div>
                    <h2 class="section-title">è£½å“æƒ…å ± / ThÃ´ng tin sáº£n pháº©m</h2>
                </div>
                <div id="productInfo">
                    <!-- Populated by JavaScript displayProductTab() -->
                </div>
            </div>
        </div>

        <!-- Tab 3: æŠ€è¡“ (Technical) -->
        <div id="technical" class="tab-pane">
            <div class="content-section">
                <div class="section-header">
                    <div class="section-icon">âš™ï¸</div>
                    <h2 class="section-title">æŠ€è¡“æƒ…å ± / ThÃ´ng tin ká»¹ thuáº­t</h2>
                </div>
                <div id="technicalInfo">
                    <!-- Populated by JavaScript displayTechnicalTab() -->
                </div>
            </div>
        </div>

        <!-- Tab 4: å‡¦ç† (Processing) -->
        <div id="processing" class="tab-pane">
            <div class="content-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ”„</div>
                    <h2 class="section-title">å‡¦ç†çŠ¶æ³ / Tráº¡ng thÃ¡i xá»­ lÃ½</h2>
                </div>
                <div id="processingStatus">
                    <!-- Populated by JavaScript displayProcessingStatus() -->
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                <div class="content-section">
                    <div class="section-header">
                        <div class="section-icon">ğŸ“</div>
                        <h2 class="section-title">ä½ç½®å±¥æ­´ / Lá»‹ch sá»­ vá»‹ trÃ­</h2>
                    </div>
                    <div id="processingLocationHistory" class="history-grid">
                        <!-- Populated by JavaScript displayProcessingLocationHistory() -->
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <div class="section-icon">ğŸšš</div>
                        <h2 class="section-title">å‡ºè·å±¥æ­´ / Lá»‹ch sá»­ váº­n chuyá»ƒn</h2>
                    </div>
                    <div id="processingShipmentHistory" class="history-grid">
                        <!-- Populated by JavaScript displayProcessingShipmentHistory() -->
                    </div>
                </div>
            </div>

            <div class="content-section">
                <div class="section-header">
                    <div class="section-icon">ğŸ’¬</div>
                    <h2 class="section-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ / BÃ¬nh luáº­n ngÆ°á»i dÃ¹ng</h2>
                </div>
                <div id="processingUserComments">
                    <!-- Populated by JavaScript displayProcessingUserComments() -->
                </div>
            </div>
        </div>

    </div>

    <!-- ===== MODALS V6.3 ===== -->
    
    <!-- Location Update Modal -->
    <div id="locationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ä½ç½®æ›´æ–° / Cáº­p nháº­t vá»‹ trÃ­</h3>
                <button class="close" onclick="hideLocationModal()">&times;</button>
            </div>
            <form id="locationForm">
                <div class="form-group">
                    <label for="rackSelect">ãƒ©ãƒƒã‚¯ / GiÃ¡ Ä‘á»¡:</label>
                    <select id="rackSelect" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ / Vui lÃ²ng chá»n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rackLayerSelect">ãƒ¬ã‚¤ãƒ¤ãƒ¼ / Táº§ng:</label>
                    <select id="rackLayerSelect" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ / Vui lÃ²ng chá»n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="employeeSelect">æ‹…å½“è€… / NgÆ°á»i thá»±c hiá»‡n:</label>
                    <select id="employeeSelect" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ / Vui lÃ²ng chá»n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="locationNotes">å‚™è€ƒ / Ghi chÃº:</label>
                    <textarea id="locationNotes" rows="3" placeholder="å‚™è€ƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit">æ›´æ–° / Cáº­p nháº­t</button>
                    <button type="button" onclick="hideLocationModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ« / Há»§y</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shipment Registration Modal -->
    <div id="shipmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å‡ºè·ç™»éŒ² / ÄÄƒng kÃ½ váº­n chuyá»ƒn</h3>
                <button class="close" onclick="hideShipmentModal()">&times;</button>
            </div>
            <form id="shipmentForm">
                <div class="form-group">
                    <label for="toCompanySelect">å‡ºè·å…ˆ / ÄÃ­ch Ä‘áº¿n:</label>
                    <select id="toCompanySelect" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ / Vui lÃ²ng chá»n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="shipmentDate">å‡ºè·æ—¥ / NgÃ y váº­n chuyá»ƒn:</label>
                    <input type="date" id="shipmentDate" required>
                </div>
                <div class="form-group">
                    <label for="handler">æ‹…å½“è€… / NgÆ°á»i xá»­ lÃ½:</label>
                    <input type="text" id="handler" placeholder="æ‹…å½“è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
                </div>
                <div class="form-group">
                    <label for="shipmentNotes">å‚™è€ƒ / Ghi chÃº:</label>
                    <textarea id="shipmentNotes" rows="3" placeholder="å‚™è€ƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit">ç™»éŒ² / ÄÄƒng kÃ½</button>
                    <button type="button" onclick="hideShipmentModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ« / Há»§y</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Comment Add Modal -->
    <div id="commentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  / ThÃªm bÃ¬nh luáº­n</h3>
                <button class="close" onclick="hideCommentModal()">&times;</button>
            </div>
            <form id="commentForm">
                <div class="form-group">
                    <label for="commentEmployeeSelect">æ‹…å½“è€… / NgÆ°á»i bÃ¬nh luáº­n:</label>
                    <select id="commentEmployeeSelect" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ / Vui lÃ²ng chá»n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="commentText">ã‚³ãƒ¡ãƒ³ãƒˆ / BÃ¬nh luáº­n:</label>
                    <textarea id="commentText" rows="4" required placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit">è¿½åŠ  / ThÃªm</button>
                    <button type="button" onclick="hideCommentModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ« / Há»§y</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingIndicator" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­... / Äang táº£i dá»¯ liá»‡u...</p>
    </div>

    <!-- Error Display -->
    <div id="errorContainer" style="display: none; position: fixed; top: 80px; left: 15px; right: 15px; background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; z-index: 9998; border-left: 4px solid #dc3545; font-size: 14px; text-align: center;"></div>

    <!-- JavaScript -->
    <script src="script.js"></script>
    <script src="detail-mold.js"></script>
    
    <script>
        // ===== V6.3 ENHANCED UI FUNCTIONS WITH COMPREHENSIVE PRINT =====
        
        function showLocationModal() {
            document.getElementById('locationModal').style.display = 'block';
        }
        
        function hideLocationModal() {
            document.getElementById('locationModal').style.display = 'none';
        }
        
        function showShipmentModal() {
            document.getElementById('shipmentModal').style.display = 'block';
        }
        
        function hideShipmentModal() {
            document.getElementById('shipmentModal').style.display = 'none';
        }
        
        function showCommentModal() {
            document.getElementById('commentModal').style.display = 'block';
        }
        
        function hideCommentModal() {
            document.getElementById('commentModal').style.display = 'none';
        }
        
        function goBack() {
            if (document.referrer && document.referrer.includes(window.location.hostname)) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }
        
        // V6.3: NEW - Comprehensive print function
        function generateComprehensivePrint() {
            console.log('V6.3: Generating comprehensive print layout...');
            
            if (typeof generateComprehensivePrintLayout === 'function') {
                generateComprehensivePrintLayout();
                
                // Wait for layout generation, then print
                setTimeout(() => {
                    window.print();
                }, 500);
            } else {
                console.error('V6.3: generateComprehensivePrintLayout function not found');
                window.print(); // Fallback
            }
        }
        
        // V6.3: NEW - PDF generation function
        function generatePDF() {
            console.log('V6.3: Generating PDF...');
            
            if (typeof generateComprehensivePrintLayout === 'function') {
                generateComprehensivePrintLayout();
                
                // Wait for layout generation, then print to PDF
                setTimeout(() => {
                    // For Chrome/Edge - this will show print dialog with PDF option
                    window.print();
                }, 500);
            } else {
                console.error('V6.3: generateComprehensivePrintLayout function not found');
                window.print(); // Fallback
            }
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = ['locationModal', 'shipmentModal', 'commentModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            if (errorContainer) {
                errorContainer.textContent = message;
                errorContainer.style.display = 'block';
                setTimeout(() => {
                    errorContainer.style.display = 'none';
                }, 5000);
            } else {
                alert(message);
            }
        }
        
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 90px;
                left: 15px;
                right: 15px;
                background: #d4edda;
                color: #155724;
                padding: 12px;
                border-radius: 6px;
                z-index: 9999;
                border-left: 4px solid #28a745;
                font-size: 14px;
                text-align: center;
                box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 3000);
        }
        
        function showLoading(show) {
            const loading = document.getElementById('loadingIndicator');
            if (loading) {
                loading.style.display = show ? 'flex' : 'none';
            }
        }
        
        console.log('MoldCutterSearch V6.3 - Enhanced HTML Structure Ready');
        console.log('âœ… Simplified Header + Comprehensive Print + Fixed Dimensions Logic');
    </script>
</body>
</html>
